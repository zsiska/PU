
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Restaurant Finder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5e79e;
      color: #333;
      margin: 0;
      padding: 0;
    }
    .dark-mode {
      background-color: #121212;
      color: #f0f0f0;
    }
    header {
      padding: 10px;
      background-color: #d4af37;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .dark-mode header {
      background-color: #1f1f1f;
    }
    #map {
      height: 400px;
      margin: 10px;
    }
    .controls {
      padding: 10px;
    }
    .restaurant {
      border: 1px solid #ccc;
      margin: 10px;
      padding: 10px;
      background-color: #fff;
    }
    .dark-mode .restaurant {
      background-color: #2a2a2a;
      border-color: #444;
    }
    .favorites {
      padding: 10px;
    }
    select, input, button {
      margin: 5px;
    }
  </style>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
  <header>
    <h2>Restaurant Finder</h2>
    <label>
      Dark Mode
      <input type="checkbox" id="darkToggle" onchange="toggleDarkMode()">
    </label>
  </header>

  <div class="controls">
    <label>Radius (km): <input type="number" id="radius" value="2" min="0.1" step="0.1"></label>
    <label>Beer Type:
      <select id="beerType">
        <option value="">Any</option>
        <option value="Pilsner Urquell">Pilsner Urquell</option>
        <option value="Budweiser">Budweiser</option>
        <option value="Staropramen">Staropramen</option>
      </select>
    </label>
    <label>Cuisine:
      <select id="cuisineType">
        <option value="">Any</option>
        <option value="czech">Czech</option>
        <option value="italian">Italian</option>
        <option value="asian">Asian</option>
      </select>
    </label>
    <label>Sort by:
      <select id="sortBy">
        <option value="distance">Distance</option>
        <option value="favorite">Favorite</option>
        <option value="cuisine">Cuisine</option>
        <option value="beer">Beer</option>
      </select>
    </label>
    <button onclick="findRestaurants()">Search</button>
  </div>

  <div id="map"></div>
  <div id="results"></div>

  <div class="favorites">
    <h3>Favorites</h3>
    <div id="favoritesList"></div>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    let map, userLat, userLon;
    let markers = [];

    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
    }

    function getDistance(lat1, lon1, lat2, lon2) {
      const R = 6371;
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon/2) * Math.sin(dLon/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c;
    }

    function saveFavorite(id, data) {
      localStorage.setItem("fav_" + id, JSON.stringify(data));
      loadFavorites();
    }

    function removeFavorite(id) {
      localStorage.removeItem("fav_" + id);
      loadFavorites();
    }

    function loadFavorites() {
      const container = document.getElementById("favoritesList");
      container.innerHTML = "";
      for (let key in localStorage) {
        if (key.startsWith("fav_")) {
          const data = JSON.parse(localStorage.getItem(key));
          const div = document.createElement("div");
          div.className = "restaurant";
          div.innerHTML = `<strong>${data.name}</strong><br>
            Cuisine: ${data.cuisine || "N/A"}<br>
            Beer: ${data.beer || "N/A"}<br>
            <button onclick="removeFavorite('${data.id}')">Remove Favorite</button>`;
          container.appendChild(div);
        }
      }
    }

    function findRestaurants() {
      const radiusKm = parseFloat(document.getElementById("radius").value);
      const beer = document.getElementById("beerType").value.toLowerCase();
      const cuisine = document.getElementById("cuisineType").value;
      const sortBy = document.getElementById("sortBy").value;

      if (!navigator.geolocation) {
        alert("Geolocation not supported.");
        return;
      }

      navigator.geolocation.getCurrentPosition(async (position) => {
        userLat = position.coords.latitude;
        userLon = position.coords.longitude;
        const radiusMeters = radiusKm * 1000;

        const query = `
          [out:json];
          (
            node["amenity"="restaurant"](around:${radiusMeters},${userLat},${userLon});
            way["amenity"="restaurant"](around:${radiusMeters},${userLat},${userLon});
            relation["amenity"="restaurant"](around:${radiusMeters},${userLat},${userLon});
          );
          out center tags;
        `;

        const response = await fetch("https://overpass-api.de/api/interpreter", {
          method: "POST",
          body: query
        });

        const data = await response.json();
        const results = document.getElementById("results");
        results.innerHTML = `<h3>Found ${data.elements.length} restaurants:</h3>`;

        if (!map) {
          map = L.map('map').setView([userLat, userLon], 14);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        } else {
          markers.forEach(m => map.removeLayer(m));
          markers = [];
        }

        let elements = data.elements.map(el => {
          const lat = el.lat || el.center?.lat;
          const lon = el.lon || el.center?.lon;
          const dist = getDistance(userLat, userLon, lat, lon);
          return { ...el, lat, lon, distance: dist };
        });

        if (beer) {
          elements = elements.filter(el => (el.tags.name || "").toLowerCase().includes(beer));
        }
        if (cuisine) {
          elements = elements.filter(el => (el.tags.cuisine || "").includes(cuisine));
        }

        if (sortBy === "distance") {
          elements.sort((a, b) => a.distance - b.distance);
        } else if (sortBy === "cuisine") {
          elements.sort((a, b) => (a.tags.cuisine || "").localeCompare(b.tags.cuisine || ""));
        } else if (sortBy === "beer") {
          elements.sort((a, b) => (a.tags.name || "").localeCompare(b.tags.name || ""));
        } else if (sortBy === "favorite") {
          elements.sort((a, b) => {
            const aFav = localStorage.getItem("fav_" + a.id) ? -1 : 1;
            const bFav = localStorage.getItem("fav_" + b.id) ? -1 : 1;
            return aFav - bFav;
          });
        }

        elements.forEach(el => {
          const name = el.tags.name || "Unnamed";
          const address = el.tags["addr:street"] || "No address";
          const cuisine = el.tags.cuisine || "N/A";
          const phone = el.tags.phone || "N/A";
          const website = el.tags.website || "";
          const opening = el.tags.opening_hours || "N/A";
          const rating = el.tags.rating || "N/A";
          const beerMatch = beer ? beer : "N/A";
          const dist = el.distance.toFixed(2);

          const div = document.createElement("div");
          div.className = "restaurant";
          div.innerHTML = `<strong>${name}</strong><br>
            Address: ${address}<br>
            Cuisine: ${cuisine}<br>
            Phone: ${phone}<br>
            Website: <a href="${website}" target="_blank">${website}</a><br>
            Opening Hours: ${opening}<br>
            Rating: ${rating}<br>
            Distance: ${dist} km<br>
            <a href="https://www.google.com/maps/dir/?api=1&destination=${el.lat},${el.lon}" target="_blank">Navigate</a><br>
            <button onclick='saveFavorite("${el.id}", ${JSON.stringify({id: el.id, name, cuisine, beer: beerMatch})})'>Add to Favorites</button>`;
          results.appendChild(div);

          const marker = L.marker([el.lat, el.lon]).addTo(map).bindPopup(name);
          markers.push(marker);
        });
      });
    }

    loadFavorites();
  </script>
</body>
</html>
